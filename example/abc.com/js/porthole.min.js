(function(c){var b={trace:function(d){try{c.console.log("Porthole: "+d)}catch(f){}},error:function(d){try{c.console.error("Porthole: "+d)}catch(f){}}};b.WindowProxy=function(){};b.WindowProxy.prototype={postMessage:function(){},addEventListener:function(d){},removeEventListener:function(d){}};b.WindowProxyLegacy=function(d,e){if(e===undefined){e=""}this.targetWindowName=e;this.eventListeners=[];this.origin=c.location.protocol+"//"+c.location.host;if(d!==null){this.proxyIFrameName=this.targetWindowName+"ProxyIFrame";this.proxyIFrameLocation=d;this.proxyIFrameElement=this.createIFrameProxy()}else{this.proxyIFrameElement=null}};b.WindowProxyLegacy.prototype={getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},createIFrameProxy:function(){var d=document.createElement("iframe");d.setAttribute("id",this.proxyIFrameName);d.setAttribute("name",this.proxyIFrameName);d.setAttribute("src",this.proxyIFrameLocation);d.setAttribute("frameBorder","1");d.setAttribute("scrolling","auto");d.setAttribute("width",30);d.setAttribute("height",30);d.setAttribute("style","position: absolute; left: -100px; top:0px;");if(d.style.setAttribute){d.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;")}document.body.appendChild(d);return d},postMessage:function(g,d){var e,h,f=c.encodeURIComponent;if(d===undefined){d="*"}if(this.proxyIFrameElement===null){b.error("Cannot send message because no proxy url was passed in the constructor")}else{e=c.name;h=(this.proxyIFrameLocation+"#data="+f(g)+"&sourceOrigin="+f(this.getOrigin())+"&targetOrigin="+f(d)+"&sourceWindowName="+f(e)+"&targetWindowName="+f(this.targetWindowName));this.proxyIFrameElement.setAttribute("src",h);this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}},addEventListener:function(d){this.eventListeners.push(d);return d},removeEventListener:function(g){var d;try{d=this.eventListeners.indexOf(g);this.eventListeners.splice(d,1)}catch(h){this.eventListeners=[];b.error(h)}},dispatchEvent:function(g){var f;for(f=0;f<this.eventListeners.length;f++){try{this.eventListeners[f](g)}catch(d){}}}};b.WindowProxyHTML5=function(d,f){if(f===undefined){f=""}this.targetWindowName=f;this.eventListeners=[];var e=function(g){var h=b.WindowProxy.unserialize(g.data);if(h&&h.sourceWindowName==f){g.data=h;this.dispatchEvent(h)}};c.addEventListener("message",e,false)};b.WindowProxyHTML5.prototype={postMessage:function(f,d){var e;if(d===undefined){d="*"}if(this.targetWindowName===""){e=top}else{if(this.targetWindowName==="top"||this.targetWindowName==="parent"){e=c[this.targetWindowName]}else{e=parent.frames[this.targetWindowName]}}e.postMessage(f,d)},addEventListener:function(d){this.eventListeners.push(d);return d},removeEventListener:function(g){var d;try{d=this.eventListeners.indexOf(g);this.eventListeners.splice(d,1)}catch(h){this.eventListeners=[];b.error(h)}},dispatchEvent:function(g){var f;for(f=0;f<this.eventListeners.length;f++){try{this.eventListeners[f](g)}catch(d){}}}};if(typeof c.postMessage!=="function"){b.trace("Using legacy browser support");b.WindowProxy=b.WindowProxyLegacy;b.WindowProxy.prototype=b.WindowProxyLegacy.prototype}else{b.trace("Using built-in browser support");b.WindowProxy=b.WindowProxyHTML5;b.WindowProxy.prototype=b.WindowProxyHTML5.prototype}b.WindowProxy.prototype.post=function(e,d){this.postMessage(b.WindowProxy.serialize(e),d)};b.WindowProxy.splitMessageParameters=function(f){if(typeof f==="undefined"||f===null){return null}var h={},g=f.split(/&/),e,d;for(e in g){if(g.hasOwnProperty(e)){d=g[e].split("=");if(typeof(d[1])==="undefined"){h[d[0]]=""}else{h[d[0]]=d[1]}}}return h};b.WindowProxy.serialize=function(d){if(typeof JSON==="undefined"){throw new Error("Porthole serialization depends on JSON!")}return JSON.stringify(d)};b.WindowProxy.unserialize=function(d){if(typeof JSON==="undefined"){throw new Error("Porthole unserialization dependens on JSON!")}return JSON.parse(d)};b.MessageEvent=function a(f,d,e){this.data=f;this.origin=d;this.source=e};b.WindowProxyDispatcher={forwardMessageEvent:function(i){var h=document.location.hash,d,g,f;if(h.length>0){h=h.substr(1);d=b.WindowProxyDispatcher.parseMessage(h);if(d.targetWindowName===""){g=top}else{if(d.targetWindowName==="top"||d.targetWindowName==="parent"){g=c[d.targetWindowName]}else{g=parent.frames[d.targetWindowName]}}f=b.WindowProxyDispatcher.findWindowProxyObjectInWindow(g,d.sourceWindowName);if(f){if(f.origin===d.targetOrigin||d.targetOrigin==="*"){i=new b.MessageEvent(d.data,d.sourceOrigin,f);f.dispatchEvent(i)}else{b.error("Target origin "+f.origin+" does not match desired target of "+d.targetOrigin)}}else{b.error("Could not find window proxy object on the target window")}}},parseMessage:function(f){var j,e,i,g=c.decodeURIComponent;if(typeof f==="undefined"||f===null){return null}j=b.WindowProxy.splitMessageParameters(f);e={data:"",sourceOrigin:"",targetOrigin:"",sourceWindowName:"",targetWindowName:""};e.data=g(j.data);e.sourceOrigin=g(j.sourceOrigin);e.targetOrigin=g(j.targetOrigin);e.targetWindowName=g(j.targetWindowName);e.sourceWindowName=g(j.sourceWindowName);return e},findWindowProxyObjectInWindow:function(d,g){var f;if(d.RuntimeObject){d=d.RuntimeObject()}if(d){for(f in d){if(d.hasOwnProperty(f)){try{if(d[f]!==null&&typeof d[f]==="object"&&d[f] instanceof d.Porthole.WindowProxy&&d[f].getTargetWindowName()===g){return d[f]}}catch(h){}}}}return null},start:function(){if(c.addEventListener){c.addEventListener("resize",b.WindowProxyDispatcher.forwardMessageEvent,false)}else{if(document.body.attachEvent){c.attachEvent("onresize",b.WindowProxyDispatcher.forwardMessageEvent)}else{b.error("Cannot attach resize event")}}}};if(typeof c.exports!=="undefined"){c.exports.Porthole=b}else{c.Porthole=b}})(this);